<!DOCTYPE html>
<html>
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js" integrity="sha512-iBAeBWWWFb8HqSBcrqcz98iIpuVH1la39dEYHtyQ/pGpeCQTQVvLJOWAuhv2Q7JSHp9k7hWA7sGxU3hHJe+tFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style> circle {fill: lightblue; stroke: black;} </style>
    <body onload='init()'>
        <p>
            <a href="index.html">Scene 1</a>   <a href="page2.html">Scene 2</a>   <a href="page3.html">Scene 3</a>
        </p>
        <svg width=300 height=300>
        </svg>
        <script>

        async function init() {
            const data = await d3.csv('https://flunky.github.io/cars2017.csv');
            var x = d3.scaleLog().base(10).domain([10,150]).range([0,200]);
            var y = d3.scaleLog().base(10).domain([10,150]).range([200,0]);

            d3.select('svg')
            .append('g')
            .attr('transform', 'translate(50,50)')
            .selectAll('circle').data(data).enter().append('circle')
            .attr('cx', function (d,i){return x(data[i]['AverageCityMPG']);})
            .attr('cy', function (d,i){return y(data[i]['AverageHighwayMPG']);})
            .attr('r', function (d,i) {return 2+parseInt(data[i]['EngineCylinders']);});

            d3.select('svg').append('g')
            .attr('transform','translate(50,50)')
            .call(d3.axisLeft(y).tickValues([10,20,50,100]).tickFormat(d3.format('~s')));

            d3.select('svg').append('g')
            .attr('transform','translate(50,250)')
            .call(d3.axisBottom(x).tickValues([10,20,50,100]).tickFormat(d3.format('~s')));
        }


        const type = d3.annotationLabel

        const annotations = [{
        note: {
            label: "Longer text to show text wrapping",
            bgPadding: 20,
            title: "Annotations :)"
        },
        //can use x, y directly instead of data
        data: { date: "18-Sep-09", close: 185.02 },
        className: "show-bg",
        dy: 137,
        dx: 162
        }]

        const parseTime = d3.timeParse("%d-%b-%y")
        const timeFormat = d3.timeFormat("%d-%b-%y")

        //Skipping setting domains for sake of example
        const x = d3.scaleTime().range([0, 800])
        const y = d3.scaleLinear().range([300, 0])

        const makeAnnotations = d3.annotation()
        .editMode(true)
        //also can set and override in the note.padding property
        //of the annotation object
        .notePadding(15)
        .type(type)
        //accessors & accessorsInverse not needed
        //if using x, y in annotations JSON
        .accessors({
            x: d => x(parseTime(d.date)),
            y: d => y(d.close)
        })
        .accessorsInverse({
            date: d => timeFormat(x.invert(d.x)),
            close: d => y.invert(d.y)
        })
        .annotations(annotations)

        d3.select("svg")
        .append("g")
        .attr("class", "annotation-group")
        .call(makeAnnotations)
        </script>
    </body>
</html>